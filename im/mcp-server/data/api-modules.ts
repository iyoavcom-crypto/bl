/**
 * @packageDocumentation
 * @module mcp-server/data/api-modules
 * @description API 模块数据定义
 */

import type { ApiModule } from "./types.js";

/** API 模块数据 */
export const API_MODULES: ApiModule[] = [
  {
    name: "认证模块",
    prefix: "/api/auth",
    description: "用户注册、登录、登出、刷新令牌",
    endpoints: [
      {
        method: "POST",
        path: "/api/auth/register",
        description: "用户注册",
        auth: false,
        requestBody: "{ phone: string, password: string, pin: string }",
        responseBody: "{ user: User, access: string, refresh: string, payload: AuthPayload }",
      },
      {
        method: "POST",
        path: "/api/auth/login",
        description: "用户登录",
        auth: false,
        requestBody: "{ phone: string, password: string }",
        responseBody: "{ user: User, access: string, refresh: string, payload: AuthPayload }",
      },
      {
        method: "POST",
        path: "/api/auth/refresh",
        description: "刷新令牌",
        auth: false,
        requestBody: "{ refreshToken: string }",
        responseBody: "{ user: User, access: string, refresh: string, payload: AuthPayload }",
      },
      {
        method: "GET",
        path: "/api/auth/me",
        description: "获取当前用户信息",
        auth: true,
        responseBody: "User",
      },
      {
        method: "POST",
        path: "/api/auth/logout",
        description: "退出登录",
        auth: true,
        responseBody: '{ message: "退出成功" }',
      },
    ],
  },
  {
    name: "用户模块",
    prefix: "/api/im/users",
    description: "用户资料、搜索、密码管理",
    endpoints: [
      {
        method: "GET",
        path: "/api/im/users/profile",
        description: "获取个人资料",
        auth: true,
        responseBody: "User",
      },
      {
        method: "PUT",
        path: "/api/im/users/profile",
        description: "更新个人资料",
        auth: true,
        requestBody: "{ name?: string, avatar?: string, gender?: string, location?: UserLocation, searchable?: boolean }",
        responseBody: "User",
      },
      {
        method: "POST",
        path: "/api/im/users/change-password",
        description: "修改密码",
        auth: true,
        requestBody: "{ oldPassword: string, newPassword: string }",
        responseBody: '{ message: "密码修改成功" }',
      },
      {
        method: "POST",
        path: "/api/im/users/change-pin",
        description: "修改二级密码",
        auth: true,
        requestBody: "{ password: string, newPin: string }",
        responseBody: '{ message: "二级密码修改成功" }',
      },
      {
        method: "POST",
        path: "/api/im/users/verify-pin",
        description: "验证二级密码",
        auth: true,
        requestBody: "{ pin: string }",
        responseBody: "{ valid: boolean }",
      },
      {
        method: "GET",
        path: "/api/im/users/search",
        description: "搜索用户",
        auth: true,
        params: "keyword: string, limit?: number",
        responseBody: "UserPublic[]",
      },
      {
        method: "GET",
        path: "/api/im/users/:userId",
        description: "获取用户公开信息",
        auth: true,
        responseBody: "UserPublic",
      },
    ],
  },
  {
    name: "设备管理",
    prefix: "/api/im/devices",
    description: "设备注册、推送令牌、心跳",
    endpoints: [
      {
        method: "GET",
        path: "/api/im/devices",
        description: "获取设备列表",
        auth: true,
        responseBody: "Device[]",
      },
      {
        method: "POST",
        path: "/api/im/devices/register",
        description: "注册设备",
        auth: true,
        requestBody:
          '{ platform: "ios"|"android"|"web"|"macos"|"windows", deviceId: string, deviceName?: string, pushToken?: string, pushProvider?: "apns"|"expo"|"fcm", appVersion?: string, osVersion?: string }',
        responseBody: "Device",
      },
      {
        method: "GET",
        path: "/api/im/devices/:deviceId",
        description: "获取设备详情",
        auth: true,
        responseBody: "Device",
      },
      {
        method: "PUT",
        path: "/api/im/devices/:deviceId",
        description: "更新设备信息",
        auth: true,
        requestBody: "{ deviceName?: string, pushToken?: string, pushProvider?: string, appVersion?: string, osVersion?: string, doNotDisturb?: boolean }",
        responseBody: "Device",
      },
      {
        method: "DELETE",
        path: "/api/im/devices/:deviceId",
        description: "删除设备",
        auth: true,
      },
      {
        method: "POST",
        path: "/api/im/devices/:deviceId/push-token",
        description: "更新推送令牌",
        auth: true,
        requestBody: "{ pushToken: string, pushProvider: string }",
        responseBody: "Device",
      },
      {
        method: "POST",
        path: "/api/im/devices/:deviceId/heartbeat",
        description: "设备心跳",
        auth: true,
        responseBody: "{ online: boolean, lastActiveAt: string }",
      },
      {
        method: "POST",
        path: "/api/im/devices/:deviceId/offline",
        description: "设备下线",
        auth: true,
        responseBody: "{ online: false }",
      },
    ],
  },
  {
    name: "好友模块",
    prefix: "/api/im/friends",
    description: "好友关系、好友申请",
    endpoints: [
      {
        method: "GET",
        path: "/api/im/friends",
        description: "获取好友列表",
        auth: true,
        params: "page?: number, limit?: number, isBlocked?: boolean, isPinned?: boolean",
        responseBody: "PagedResponse<Friend>",
      },
      {
        method: "GET",
        path: "/api/im/friends/:userId",
        description: "获取好友详情",
        auth: true,
        responseBody: "Friend",
      },
      {
        method: "PUT",
        path: "/api/im/friends/:userId",
        description: "更新好友设置",
        auth: true,
        requestBody: "{ alias?: string, isBlocked?: boolean, doNotDisturb?: boolean, isPinned?: boolean }",
        responseBody: "Friend",
      },
      {
        method: "DELETE",
        path: "/api/im/friends/:userId",
        description: "删除好友",
        auth: true,
      },
      {
        method: "GET",
        path: "/api/im/friends/check/:userId",
        description: "检查是否为好友",
        auth: true,
        responseBody: "{ isFriend: boolean }",
      },
      {
        method: "POST",
        path: "/api/im/friends/requests",
        description: "发送好友申请",
        auth: true,
        requestBody: '{ toUserId: string, message?: string, source: "search"|"qr"|"phone"|"invite" }',
        responseBody: "FriendRequest",
      },
      {
        method: "GET",
        path: "/api/im/friends/requests/received",
        description: "获取收到的好友申请",
        auth: true,
        params: "status?: string",
        responseBody: "FriendRequest[]",
      },
      {
        method: "GET",
        path: "/api/im/friends/requests/sent",
        description: "获取发出的好友申请",
        auth: true,
        params: "status?: string",
        responseBody: "FriendRequest[]",
      },
      {
        method: "POST",
        path: "/api/im/friends/requests/:requestId/accept",
        description: "接受好友申请",
        auth: true,
        responseBody: "{ friend: Friend, reverse: Friend, conversationId: string }",
      },
      {
        method: "POST",
        path: "/api/im/friends/requests/:requestId/reject",
        description: "拒绝好友申请",
        auth: true,
        responseBody: "FriendRequest",
      },
    ],
  },
  {
    name: "好友申请 CRUD",
    prefix: "/api/im/friend-requests",
    description: "好友申请管理 CRUD",
    endpoints: [
      {
        method: "GET",
        path: "/api/im/friend-requests",
        description: "获取好友申请列表",
        auth: true,
        params: "page?: number, limit?: number, status?: string",
        responseBody: "PagedResponse<FriendRequest>",
      },
      {
        method: "POST",
        path: "/api/im/friend-requests",
        description: "发送好友申请",
        auth: true,
        requestBody: '{ toUserId: string, message?: string, source: "search"|"qr"|"phone"|"invite" }',
        responseBody: "FriendRequest",
      },
      {
        method: "GET",
        path: "/api/im/friend-requests/:id",
        description: "获取好友申请详情",
        auth: true,
        responseBody: "FriendRequest",
      },
      {
        method: "PUT",
        path: "/api/im/friend-requests/:id",
        description: "处理好友申请（接受/拒绝）",
        auth: true,
        requestBody: '{ status: "accepted"|"rejected" }',
        responseBody: "FriendRequest",
      },
      {
        method: "DELETE",
        path: "/api/im/friend-requests/:id",
        description: "删除好友申请",
        auth: true,
      },
    ],
  },
  {
    name: "群组模块",
    prefix: "/api/im/groups",
    description: "群组创建、成员管理",
    endpoints: [
      {
        method: "GET",
        path: "/api/im/groups",
        description: "获取我的群组列表",
        auth: true,
        responseBody: "Group[]",
      },
      {
        method: "POST",
        path: "/api/im/groups",
        description: "创建群组",
        auth: true,
        requestBody: '{ name: string, avatar?: string, description?: string, joinMode?: "open"|"approval"|"invite", memberIds?: string[] }',
        responseBody: "Group",
      },
      {
        method: "GET",
        path: "/api/im/groups/:groupId",
        description: "获取群组详情",
        auth: true,
        responseBody: "Group",
      },
      {
        method: "PUT",
        path: "/api/im/groups/:groupId",
        description: "更新群组信息",
        auth: true,
        requestBody: "{ name?: string, avatar?: string, description?: string, joinMode?: string, muteAll?: boolean }",
        responseBody: "Group",
      },
      {
        method: "DELETE",
        path: "/api/im/groups/:groupId",
        description: "解散群组（仅群主）",
        auth: true,
      },
      {
        method: "GET",
        path: "/api/im/groups/:groupId/members",
        description: "获取群成员列表",
        auth: true,
        responseBody: "GroupMember[]",
      },
      {
        method: "POST",
        path: "/api/im/groups/:groupId/invite",
        description: "邀请成员",
        auth: true,
        requestBody: "{ userIds: string[] }",
        responseBody: "GroupMember[]",
      },
      {
        method: "POST",
        path: "/api/im/groups/:groupId/kick/:userId",
        description: "踢出成员",
        auth: true,
      },
      {
        method: "POST",
        path: "/api/im/groups/:groupId/leave",
        description: "退出群组",
        auth: true,
      },
      {
        method: "POST",
        path: "/api/im/groups/:groupId/transfer",
        description: "转让群主",
        auth: true,
        requestBody: "{ newOwnerId: string }",
        responseBody: '{ message: "转让成功" }',
      },
      {
        method: "POST",
        path: "/api/im/groups/:groupId/admin/:userId",
        description: "设置管理员",
        auth: true,
        responseBody: '{ message: "设置成功" }',
      },
      {
        method: "DELETE",
        path: "/api/im/groups/:groupId/admin/:userId",
        description: "取消管理员",
        auth: true,
        responseBody: '{ message: "取消成功" }',
      },
      {
        method: "POST",
        path: "/api/im/groups/:groupId/mute/:userId",
        description: "禁言成员",
        auth: true,
        requestBody: "{ duration?: number }",
        responseBody: '{ message: "禁言成功" }',
      },
      {
        method: "DELETE",
        path: "/api/im/groups/:groupId/mute/:userId",
        description: "解除禁言",
        auth: true,
        responseBody: '{ message: "解除禁言成功" }',
      },
    ],
  },
  {
    name: "群成员 CRUD",
    prefix: "/api/im/group-members",
    description: "群成员管理 CRUD",
    endpoints: [
      {
        method: "GET",
        path: "/api/im/group-members",
        description: "获取群成员列表",
        auth: true,
        params: "groupId?: string, page?: number, limit?: number",
        responseBody: "PagedResponse<GroupMember>",
      },
      {
        method: "POST",
        path: "/api/im/group-members",
        description: "添加群成员",
        auth: true,
        requestBody: '{ groupId: string, userId: string, role?: "admin"|"member" }',
        responseBody: "GroupMember",
      },
      {
        method: "GET",
        path: "/api/im/group-members/:id",
        description: "获取群成员详情",
        auth: true,
        responseBody: "GroupMember",
      },
      {
        method: "PUT",
        path: "/api/im/group-members/:id",
        description: "更新群成员信息（昵称/角色/禁言等）",
        auth: true,
        requestBody: '{ groupNickname?: string, role?: "admin"|"member", isMuted?: boolean, muteUntil?: string }',
        responseBody: "GroupMember",
      },
      {
        method: "DELETE",
        path: "/api/im/group-members/:id",
        description: "移除群成员",
        auth: true,
      },
    ],
  },
  {
    name: "会话模块",
    prefix: "/api/im/conversations",
    description: "会话列表、私聊",
    endpoints: [
      {
        method: "GET",
        path: "/api/im/conversations",
        description: "获取会话列表",
        auth: true,
        responseBody: "Conversation[]",
      },
      {
        method: "POST",
        path: "/api/im/conversations/private",
        description: "发起私聊",
        auth: true,
        requestBody: "{ targetUserId: string }",
        responseBody: "Conversation",
      },
      {
        method: "GET",
        path: "/api/im/conversations/:conversationId",
        description: "获取会话详情",
        auth: true,
        responseBody: "Conversation",
      },
      {
        method: "DELETE",
        path: "/api/im/conversations/:conversationId",
        description: "删除会话",
        auth: true,
      },
      {
        method: "POST",
        path: "/api/im/conversations/:conversationId/clear-unread",
        description: "清空未读",
        auth: true,
        responseBody: '{ message: "清空成功" }',
      },
      {
        method: "POST",
        path: "/api/im/conversations/:conversationId/typing",
        description: "发送输入状态",
        auth: true,
        requestBody: "{ isTyping: boolean }",
        responseBody: '{ message: "状态已发送" }',
      },
    ],
  },
  {
    name: "消息模块",
    prefix: "/api/im/messages",
    description: "消息发送、撤回、已读",
    endpoints: [
      {
        method: "POST",
        path: "/api/im/messages",
        description: "发送消息",
        auth: true,
        requestBody: '{ conversationId: string, type: "text"|"image"|"voice", content?: string, mediaUrl?: string, mediaDuration?: number, replyToId?: string }',
        responseBody: "Message",
      },
      {
        method: "GET",
        path: "/api/im/messages/conversation/:conversationId",
        description: "获取会话消息列表",
        auth: true,
        params: "page?: number, limit?: number",
        responseBody: "PagedResponse<Message>",
      },
      {
        method: "GET",
        path: "/api/im/messages/:messageId",
        description: "获取消息详情",
        auth: true,
        responseBody: "Message",
      },
      {
        method: "POST",
        path: "/api/im/messages/:messageId/recall",
        description: "撤回消息（120秒内）",
        auth: true,
        responseBody: "Message",
      },
      {
        method: "POST",
        path: "/api/im/messages/:messageId/forward",
        description: "转发消息",
        auth: true,
        requestBody: "{ conversationIds: string[] }",
        responseBody: "Message[]",
      },
      {
        method: "POST",
        path: "/api/im/messages/conversation/:conversationId/read",
        description: "标记已读",
        auth: true,
        requestBody: "{ messageId: string }",
        responseBody: '{ message: "标记成功" }',
      },
      {
        method: "POST",
        path: "/api/im/messages/:messageId/delivered",
        description: "标记送达",
        auth: true,
        responseBody: '{ message: "标记成功" }',
      },
      {
        method: "POST",
        path: "/api/im/messages/batch-delivered",
        description: "批量标记送达",
        auth: true,
        requestBody: "{ messageIds: string[] }",
        responseBody: '{ message: "批量标记成功" }',
      },
      {
        method: "POST",
        path: "/api/im/messages/search",
        description: "搜索消息",
        auth: true,
        requestBody: "{ keyword: string, conversationId?: string, senderId?: string, type?: string, startDate?: string, endDate?: string, limit?: number, offset?: number }",
        responseBody: "{ messages: Message[], total: number, hasMore: boolean }",
      },
    ],
  },
  {
    name: "通话模块",
    prefix: "/api/im/calls",
    description: "语音通话、WebRTC 信令",
    endpoints: [
      {
        method: "GET",
        path: "/api/im/calls",
        description: "获取通话记录",
        auth: true,
        params: "page?: number, limit?: number",
        responseBody: "PagedResponse<Call>",
      },
      {
        method: "POST",
        path: "/api/im/calls/initiate",
        description: "发起通话",
        auth: true,
        requestBody: "{ calleeId: string }",
        responseBody: "Call",
      },
      {
        method: "GET",
        path: "/api/im/calls/:callId",
        description: "获取通话详情",
        auth: true,
        responseBody: "Call",
      },
      {
        method: "POST",
        path: "/api/im/calls/:callId/ring",
        description: "响铃（被叫收到后调用）",
        auth: true,
        responseBody: "Call",
      },
      {
        method: "POST",
        path: "/api/im/calls/:callId/accept",
        description: "接听通话",
        auth: true,
        responseBody: "Call",
      },
      {
        method: "POST",
        path: "/api/im/calls/:callId/reject",
        description: "拒接通话",
        auth: true,
        responseBody: "Call",
      },
      {
        method: "POST",
        path: "/api/im/calls/:callId/hangup",
        description: "挂断通话",
        auth: true,
        responseBody: "Call",
      },
      {
        method: "POST",
        path: "/api/im/calls/:callId/signal",
        description: "发送 WebRTC 信令",
        auth: true,
        requestBody: '{ signalType: "offer"|"answer"|"ice-candidate", signalData: { sdp?: string, candidate?: string, sdpMid?: string, sdpMLineIndex?: number } }',
        responseBody: '{ message: "信令已发送" }',
      },
    ],
  },
  {
    name: "在线状态",
    prefix: "/api/im/presence",
    description: "用户在线状态查询",
    endpoints: [
      {
        method: "GET",
        path: "/api/im/presence/check/:userId",
        description: "检查用户是否在线",
        auth: true,
        responseBody: "{ userId: string, isOnline: boolean }",
      },
      {
        method: "GET",
        path: "/api/im/presence/status/:userId",
        description: "获取用户详细在线状态",
        auth: true,
        responseBody: "{ userId: string, isOnline: boolean, lastOnlineAt?: string, onlineDeviceCount?: number }",
      },
      {
        method: "POST",
        path: "/api/im/presence/batch",
        description: "批量获取在线状态",
        auth: true,
        requestBody: "{ userIds: string[] }",
        responseBody: "PresenceStatus[]",
      },
      {
        method: "GET",
        path: "/api/im/presence/friends",
        description: "获取好友在线状态",
        auth: true,
        responseBody: "PresenceStatus[]",
      },
    ],
  },
  {
    name: "媒体文件",
    prefix: "/api/im/media",
    description: "文件上传",
    endpoints: [
      {
        method: "POST",
        path: "/api/im/media/upload",
        description: "上传单个文件",
        auth: true,
        requestBody: "multipart/form-data: file",
        responseBody: "{ type: string, url: string, filename: string, originalName: string, mimeType: string, size: number }",
      },
      {
        method: "POST",
        path: "/api/im/media/upload/multiple",
        description: "上传多个文件（最多9个）",
        auth: true,
        requestBody: "multipart/form-data: files[]",
        responseBody: "MediaUploadResult[]",
      },
      {
        method: "DELETE",
        path: "/api/im/media/:type/:filename",
        description: "删除文件",
        auth: true,
      },
      {
        method: "GET",
        path: "/api/im/media/limits",
        description: "获取上传限制",
        auth: true,
        responseBody: "{ allowedTypes: string[], sizeLimits: { image: number, audio: number, video: number, file: number }, maxFiles: number }",
      },
    ],
  },
];
