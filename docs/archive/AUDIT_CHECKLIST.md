# 前后端代码审核清单

> **使用说明**: AI审核时会自动更新状态列和审核发现列，人工审核时手动编辑

---

## 审核元信息

| 字段 | 值 |
|-----|-----|
| 审核日期 | |
| 审核人员 | |
| 项目版本 | |
| 审核范围 | |
| 前端路径 | |
| 后端路径 | |

---

## 状态图例

| 符号 | 含义 |
|-----|------|
| ⬜ | 待审核 |
| ✅ | 通过 |
| ❌ | 失败 |
| ⚠️ | 警告/需关注 |

---

## 1. WebSocket 事件审核

### 1.1 事件类型一致性

| ID | 检查项 | 审查标准 | 状态 | 审核时间 | 审核发现 |
|----|--------|---------|------|---------|---------|
| WS-01 | 事件类型定义对比 | 前端 `types/websocket.ts` 与后端 `websocket/events/types.ts` 事件枚举完全一致 | ⬜ | | |
| WS-02 | 后端事件前端声明覆盖 | 后端 emit 的每个事件，前端都有对应 type 声明 | ⬜ | | |
| WS-03 | 事件名称拼写一致性 | 事件名完全匹配（如不能 `group:muted` vs `group_muted`） | ⬜ | | |

### 1.2 Payload 类型字段匹配

| ID | 检查项 | 审查标准 | 状态 | 审核时间 | 审核发现 |
|----|--------|---------|------|---------|---------|
| WS-04 | Payload 接口定义对比 | 前后端 Payload interface 字段数量一致 | ⬜ | | |
| WS-05 | 字段名一致性 | 字段名完全相同（如不能 `operatorId` vs `kickedBy`） | ⬜ | | |
| WS-06 | 字段类型一致性 | 字段类型匹配（如不能 `number` vs `string`） | ⬜ | | |
| WS-07 | 遗漏字段检查 | 后端返回的字段前端都有定义，无遗漏 | ⬜ | | |
| WS-08 | 嵌套对象结构一致性 | 嵌套对象结构完全匹配（如 `member: {id,name}` 结构一致） | ⬜ | | |

### 1.3 事件监听器绑定

| ID | 检查项 | 审查标准 | 状态 | 审核时间 | 审核发现 |
|----|--------|---------|------|---------|---------|
| WS-09 | handle* 方法对应 setupWsListeners | 每个 `handle*` 方法都在 `setupWsListeners` 中被调用 | ⬜ | | |
| WS-10 | App.tsx 调用所有 setupWsListeners | App.tsx 中调用了所有 Store 的 `setupWsListeners` | ⬜ | | |
| WS-11 | 监听器在 isAuthenticated 后初始化 | `useEffect` 依赖 `isAuthenticated`，认证后才绑定 | ⬜ | | |
| WS-12 | cleanup 函数正确调用 | `useEffect` 返回 cleanup，组件卸载时解绑监听 | ⬜ | | |

---

## 2. API 接口审核

### 2.1 请求参数

| ID | 检查项 | 审查标准 | 状态 | 审核时间 | 审核发现 |
|----|--------|---------|------|---------|---------|
| API-01 | 调用参数与路由期望参数匹配 | 前端传参与后端 controller 期望参数一一对应 | ⬜ | | |
| API-02 | 必填字段传递完整 | 后端 required 字段前端都传递（如 `source` 字段） | ⬜ | | |
| API-03 | 参数类型正确 | 参数格式匹配（对象 vs 分散参数、FormData vs JSON） | ⬜ | | |

### 2.2 响应数据

| ID | 检查项 | 审查标准 | 状态 | 审核时间 | 审核发现 |
|----|--------|---------|------|---------|---------|
| API-04 | 类型定义与实际返回一致 | 前端 Response 类型与后端实际返回结构完全匹配 | ⬜ | | |
| API-05 | 数据包装层级正确 | 正确处理包装层（`response.data` vs `response.data.data`） | ⬜ | | |
| API-06 | 数组/对象格式兼容 | 单条数据返回对象，多条返回数组，前端处理正确 | ⬜ | | |

### 2.3 API 路径

| ID | 检查项 | 审查标准 | 状态 | 审核时间 | 审核发现 |
|----|--------|---------|------|---------|---------|
| API-07 | API_PATHS 与后端路由匹配 | 前端 `API_PATHS` 常量与后端路由定义完全一致 | ⬜ | | |
| API-08 | RESTful 动词正确 | HTTP 方法匹配（GET查/POST增/PUT改/DELETE删） | ⬜ | | |

---

## 3. Store 逻辑审核

### 3.1 方法命名一致性

| ID | 检查项 | 审查标准 | 状态 | 审核时间 | 审核发现 |
|----|--------|---------|------|---------|---------|
| STORE-01 | 方法名一致 | 页面调用的方法名与 Store 导出的方法名完全一致 | ⬜ | | |
| STORE-02 | 拼写/大小写一致 | 无拼写错误或大小写不一致（如 `sendRequest` vs `SendRequest`） | ⬜ | | |

### 3.2 状态更新逻辑

| ID | 检查项 | 审查标准 | 状态 | 审核时间 | 审核发现 |
|----|--------|---------|------|---------|---------|
| STORE-03 | 乐观更新有回滚逻辑 | 乐观更新失败时有 try-catch 回滚到原状态 | ⬜ | | |
| STORE-04 | 状态流转完整 | 状态机完整（如 pending→sent→delivered→read） | ⬜ | | |
| STORE-05 | 重复数据防护 | 添加数据前有 `exists` / `find` 检查防重复 | ⬜ | | |

### 3.3 数据转换

| ID | 检查项 | 审查标准 | 状态 | 审核时间 | 审核发现 |
|----|--------|---------|------|---------|---------|
| STORE-06 | API 响应到 Store 状态转换正确 | API 返回数据正确映射到 Store 状态字段 | ⬜ | | |
| STORE-07 | WebSocket payload 到 Store 转换正确 | WS 事件 payload 字段正确映射到 Store 状态 | ⬜ | | |

---

## 4. 通知系统审核

### 4.1 推送通知

| ID | 检查项 | 审查标准 | 状态 | 审核时间 | 审核发现 |
|----|--------|---------|------|---------|---------|
| NOTIFY-01 | 推送场景与 NotificationType 对应 | 后端每个推送场景前端都有对应 `NotificationType` 枚举 | ⬜ | | |
| NOTIFY-02 | 离线推送条件检查 | 检查 isOnline/doNotDisturb/token 有效性后再推送 | ⬜ | | |
| NOTIFY-03 | data.type 与 NotificationType 匹配 | 推送 payload 的 `data.type` 与前端枚举值一致 | ⬜ | | |

### 4.2 通知导航

| ID | 检查项 | 审查标准 | 状态 | 审核时间 | 审核发现 |
|----|--------|---------|------|---------|---------|
| NOTIFY-04 | handleNotificationResponse 覆盖所有类型 | switch-case 覆盖所有 `NotificationType`，有 default 兜底 | ⬜ | | |
| NOTIFY-05 | 导航目标页面和参数正确 | 点击通知跳转到正确页面，携带正确参数 | ⬜ | | |
| NOTIFY-06 | 角标数量同步逻辑 | 未读数变化时角标正确更新 | ⬜ | | |

---

## 5. UI 展示审核

### 5.1 数据绑定

| ID | 检查项 | 审查标准 | 状态 | 审核时间 | 审核发现 |
|----|--------|---------|------|---------|---------|
| UI-01 | selector 正确返回数据 | useSelector 选择器返回正确的 state 切片 | ⬜ | | |
| UI-02 | 字段访问与类型定义一致 | 渲染时访问的字段与类型定义一致（如不能 `item.account` 访问不存在字段） | ⬜ | | |

### 5.2 状态展示

| ID | 检查项 | 审查标准 | 状态 | 审核时间 | 审核发现 |
|----|--------|---------|------|---------|---------|
| UI-03 | loading 状态正确显示 | 请求中显示加载指示器，完成后隐藏 | ⬜ | | |
| UI-04 | 空状态正确处理 | 列表为空时显示空状态提示，非 undefined 报错 | ⬜ | | |
| UI-05 | 错误状态正确提示 | 请求失败时显示错误提示，非静默失败 | ⬜ | | |

### 5.3 交互反馈

| ID | 检查项 | 审查标准 | 状态 | 审核时间 | 审核发现 |
|----|--------|---------|------|---------|---------|
| UI-06 | 按钮禁用状态逻辑 | 请求中/条件不满足时按钮禁用，防重复提交 | ⬜ | | |
| UI-07 | Toast/Alert 提示合适 | 操作成功/失败有对应提示，文案准确 | ⬜ | | |

---

## 6. 三重验证（功能正常性）

### 6.1 第一重：代码合规性

| ID | 检查项 | 审查标准 | 状态 | 审核时间 | 审核发现 |
|----|--------|---------|------|---------|---------|
| V1-01 | 字段/方法对齐 | 前后端类型定义、方法签名完全一致 | ⬜ | | |
| V1-02 | 类型检查通过 (tsc --noEmit) | 运行 `npx tsc --noEmit` 无报错 | ⬜ | | |
| V1-03 | Lint 检查通过 | 运行 `npm run lint` 无报错 | ⬜ | | |
| V1-04 | 接口签名匹配 | API 参数、返回值与设计文档严格一致 | ⬜ | | |

### 6.2 第二重：联调可用性

| ID | 检查项 | 审查标准 | 状态 | 审核时间 | 审核发现 |
|----|--------|---------|------|---------|---------|
| V2-01 | HTTP 接口可达 | Postman/curl 测试返回 200/201 | ⬜ | | |
| V2-02 | WebSocket 连接正常 | 控制台日志显示连接成功、心跳正常 | ⬜ | | |
| V2-03 | 数据流转正确 | 请求→处理→响应→状态更新 全链路正常 | ⬜ | | |
| V2-04 | 错误处理有效 | 模拟网络断开/超时/4xx/5xx 有正确处理 | ⬜ | | |

### 6.3 第三重：前端展现效果

| ID | 检查项 | 审查标准 | 状态 | 审核时间 | 审核发现 |
|----|--------|---------|------|---------|---------|
| V3-01 | UI 正确渲染 | 真机/模拟器上数据正确显示 | ⬜ | | |
| V3-02 | 交互响应正常 | 按钮点击、输入、滚动等交互正常 | ⬜ | | |
| V3-03 | 状态变化正确 | loading→success→error 状态切换正确 | ⬜ | | |
| V3-04 | 边界情况处理 | 空列表、超长文本、大数据量 显示正常 | ⬜ | | |

---

## 7. 功能测试用例

> AI审核时根据代码自动生成测试用例

| 用例ID | 功能点 | 操作步骤 | 预期结果 | 实际结果 | 状态 |
|--------|--------|---------|---------|---------|------|
| TC-01 | | | | | ⬜ |
| TC-02 | | | | | ⬜ |
| TC-03 | | | | | ⬜ |

---

## 8. 审核结果汇总

| 模块 | 总数 | ✅ | ❌ | ⬜ | 通过率 |
|------|------|----|----|----|----|
| WebSocket 事件 | 12 | 0 | 0 | 12 | 0% |
| API 接口 | 8 | 0 | 0 | 8 | 0% |
| Store 逻辑 | 7 | 0 | 0 | 7 | 0% |
| 通知系统 | 6 | 0 | 0 | 6 | 0% |
| UI 展示 | 7 | 0 | 0 | 7 | 0% |
| 三重验证 | 12 | 0 | 0 | 12 | 0% |
| **总计** | **52** | **0** | **0** | **52** | **0%** |

---

## 9. 问题清单

| 问题ID | 关联ID | 问题描述 | 严重程度 | 修复建议 | 状态 |
|--------|--------|---------|---------|---------|------|
| P-01 | | | 高/中/低 | | ⬜ |
| P-02 | | | 高/中/低 | | ⬜ |

---

## 10. 审核签字

| 项目 | 内容 |
|-----|------|
| 审核人 | |
| 完成时间 | |
| 总体结论 | ⬜ 通过 / ⬜ 有条件通过 / ⬜ 不通过 |
| 备注 | |

---

## 常见问题速查表

| 问题类型 | 检查位置 | 典型错误示例 |
|---------|---------|-------------|
| 方法名不存在 | 页面调用 Store | `sendFriendRequest` vs `sendRequest` |
| 字段名不匹配 | Payload 类型 | `kickedBy` vs `operatorId` |
| 事件未绑定 | App.tsx | 缺少 `setupGroupListeners()` 调用 |
| 类型不匹配 | 嵌套对象 | `member: GroupMember` vs `member: {id,name}` |
| 导航缺失 | notificationStore | 缺少 `group_kicked` case |
| 字段访问错误 | 页面渲染 | `item.account` (不存在) |
