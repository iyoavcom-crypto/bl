# 前端应用测试指南

**测试时间**: 2026-01-28  
**环境**: React Native + Expo

---

## 🚀 服务状态

### ✅ 后端服务 (已启动)
- **地址**: http://192.168.1.6:3009
- **WebSocket**: ws://192.168.1.6:3009/ws
- **健康检查**: http://192.168.1.6:3009/health
- **状态**: ✅ 运行中

### ✅ 前端服务 (已启动)
- **Metro Bundler**: http://localhost:8002
- **状态**: ✅ 运行中
- **警告**: 
  - `react-native-web@0.19.13` (期望 0.21.0) - 不影响原生应用
  - `react-native-worklets@0.7.2` (期望 0.5.1) - 可能影响动画性能

---

## 📱 如何启动应用

### 方法1: 使用 Expo Go (推荐快速测试)

1. 在手机上安装 **Expo Go** 应用
   - iOS: App Store 搜索 "Expo Go"
   - Android: Google Play 搜索 "Expo Go"

2. 确保手机和电脑在同一局域网

3. 打开 Expo Go，扫描二维码或输入地址:
   ```
   exp://192.168.1.6:8002
   ```

### 方法2: 原生构建 (完整测试)

**Android**:
```bash
cd my-app
npm run android
```

**iOS** (需要 Mac):
```bash
cd my-app
npm run ios
```

---

## 🧪 测试用户账号

| 用户 | 手机号 | 密码 | 用户ID | 说明 |
|------|--------|------|--------|------|
| 测试用户1 | 13800138001 | Test123456 | 6166202 | 主测试账号 |
| 测试用户2 | 13800138002 | Test123456 | 4238617 | 辅助测试账号 |

**说明**: 
- 这两个账号已经是好友关系
- 已有会话 ID: `1bd4de84-4870-4510-8d48-0cb00d31fcc9`

---

## ✅ 测试流程

### 1. 认证测试

#### 1.1 登录测试
1. 打开应用，应该看到登录页面
2. 输入手机号: `13800138001`
3. 输入密码: `Test123456`
4. 点击登录

**预期结果**:
- ✅ 成功登录
- ✅ 自动跳转到主界面（底部三个Tab）
- ✅ Token 已保存到本地

**检查点**:
- [ ] 登录按钮在输入时是否启用
- [ ] 登录失败时是否显示错误提示
- [ ] 登录成功后是否清除输入框

#### 1.2 注册测试（可选）
如果需要创建新用户:
1. 点击"注册"按钮
2. 填写手机号（如 13800138003）
3. 填写姓名、密码、6位PIN码
4. 选择性别
5. 点击注册

---

### 2. 主界面测试

#### 2.1 会话列表 (Tab 1: 聊天)

**应该看到**:
- ✅ 至少一个会话（与测试用户2的私聊）
- ✅ 会话显示对方昵称/备注
- ✅ 显示最后一条消息内容
- ✅ 显示时间戳
- ⚠️ 未读消息角标（如果有未读消息）

**测试步骤**:
1. 点击会话进入聊天室
2. 下拉刷新会话列表
3. 长按会话查看菜单（删除、置顶等）

**检查点**:
- [ ] 会话列表是否加载
- [ ] 点击会话是否进入聊天室
- [ ] 下拉刷新是否工作
- [ ] 时间显示是否正确

#### 2.2 通讯录 (Tab 2: 通讯录)

**应该看到**:
- ✅ "新好友申请" 入口（带角标，如果有未处理申请）
- ✅ 好友列表
- ✅ "添加好友" 按钮

**测试步骤**:
1. 查看好友列表（至少有测试用户2）
2. 点击"添加好友"按钮
3. 点击"新好友申请"查看申请列表

**检查点**:
- [ ] 好友列表是否显示
- [ ] 好友昵称/备注是否正确
- [ ] 角标数字是否正确

#### 2.3 我的 (Tab 3: 我的)

**应该看到**:
- ✅ 当前用户头像、昵称、账号
- ✅ "设置"按钮
- ✅ "我的二维码"选项

**测试步骤**:
1. 点击"设置"进入设置页面
2. 点击"我的二维码"查看二维码

---

### 3. 私聊功能测试 🔥 核心功能

#### 3.1 进入聊天室
1. 从会话列表点击与测试用户2的会话
2. 或从通讯录点击好友 → 点击"发送消息"

**应该看到**:
- ✅ 导航栏显示对方昵称
- ✅ 消息列表（可能已有历史消息）
- ✅ 底部输入框
- ✅ 发送按钮

#### 3.2 发送文本消息
1. 在输入框输入: "你好，这是测试消息"
2. 点击发送按钮

**预期结果**:
- ✅ 消息立即显示在列表中
- ✅ 消息显示"发送中"状态
- ✅ 消息变为"已发送"状态
- ✅ 消息气泡在右侧（自己的消息）

**检查点**:
- [ ] 消息是否立即显示
- [ ] 消息状态是否正确
- [ ] 消息时间是否显示
- [ ] 滚动是否自动到底部

#### 3.3 接收消息
**测试方法**: 使用另一台设备或模拟器登录测试用户2

在测试用户2设备上:
1. 进入与测试用户1的会话
2. 发送消息: "收到了，你好！"

在测试用户1设备上:
**预期结果**:
- ✅ 实时收到消息（通过WebSocket）
- ✅ 消息气泡在左侧（对方的消息）
- ✅ 显示对方昵称（如果是群聊）

#### 3.4 消息撤回测试
1. 长按自己发送的消息（2分钟内）
2. 选择"撤回"

**预期结果**:
- ✅ 显示确认对话框
- ✅ 撤回后消息变为"你撤回了一条消息"
- ✅ 对方也会收到撤回通知

**检查点**:
- [ ] 长按菜单是否显示
- [ ] 超过2分钟的消息是否禁止撤回
- [ ] 撤回后双方消息是否同步

#### 3.5 敏感词过滤测试 🛡️
1. 输入包含敏感词的消息: "我想去赌博和看色情内容"
2. 发送

**预期结果**:
- ✅ 消息成功发送
- ✅ 后端已过滤敏感词（存储为 `***`）
- ⚠️ 前端显示可能仍是原文（取决于实现）

**验证方法**:
- 刷新页面或重新进入会话
- 从服务器拉取的消息应该显示为过滤后的内容

---

### 4. 好友管理测试

#### 4.1 搜索并添加好友
1. 进入通讯录 → 点击"添加好友"
2. 输入手机号或昵称搜索
3. 点击搜索结果
4. 输入验证消息: "你好，我想加你为好友"
5. 选择好友来源: "搜索"
6. 点击"发送申请"

**预期结果**:
- ✅ 显示"申请已发送"提示
- ✅ 对方会收到好友申请

#### 4.2 处理好友申请
**使用测试用户2登录**:
1. 进入通讯录 → 点击"新好友申请"
2. 看到测试用户1的申请
3. 点击"接受"

**预期结果**:
- ✅ 自动成为好友
- ✅ 自动创建私聊会话
- ✅ 双方好友列表都更新

#### 4.3 查看好友详情
1. 从通讯录点击好友
2. 查看好友资料

**应该看到**:
- 好友头像、昵称、性别
- "设置备注"选项
- "发送消息"按钮
- "删除好友"按钮（红色）

#### 4.4 设置备注
1. 点击"设置备注"
2. 输入备注名
3. 保存

**预期结果**:
- ✅ 好友列表显示备注而非昵称
- ✅ 会话列表也显示备注

---

### 5. 群聊功能测试

#### 5.1 创建群组
1. 进入通讯录 → 点击"发起群聊"或类似按钮
2. 选择多个好友（至少2个）
3. 设置群名称: "测试群组"
4. 点击"创建"

**预期结果**:
- ✅ 群组创建成功
- ✅ 自动进入群聊天室
- ✅ 会话列表显示新群组

#### 5.2 群聊发送消息
在群聊天室:
1. 发送消息: "大家好！"
2. 查看消息显示

**预期结果**:
- ✅ 消息发送成功
- ✅ 群成员都能收到
- ✅ 显示发送者昵称

#### 5.3 查看群信息
1. 点击聊天室右上角的群名称或"..."按钮
2. 进入群信息页面

**应该看到**:
- ✅ 群名称、群头像
- ✅ 群成员列表（带头像）
- ✅ "邀请成员"按钮
- ✅ "群管理"按钮（如果是群主/管理员）
- ✅ "退出群组"按钮

#### 5.4 邀请成员
1. 点击"邀请成员"
2. 从好友列表选择成员
3. 确认邀请

**预期结果**:
- ✅ 新成员加入
- ✅ 群聊显示系统消息："XXX加入了群聊"
- ✅ 群成员列表更新

#### 5.5 群管理（群主功能）
**如果你是群主**:
1. 进入群信息 → 点击"管理成员"
2. 测试以下功能:

**设置管理员**:
- 长按成员 → 选择"设为管理员"
- 预期: 成员角色变更

**踢出成员**:
- 长按成员 → 选择"移出群聊"
- 预期: 成员被移除，收到通知

**禁言成员**:
- 长按成员 → 选择"禁言"
- 设置禁言时长
- 预期: 该成员无法在群内发言

**全员禁言**:
- 开启"全员禁言"开关
- 预期: 除管理员外无人可发言

#### 5.6 退出群组
1. 进入群信息
2. 滚动到底部，点击"退出群组"
3. 确认退出

**预期结果**:
- ✅ 退出成功
- ✅ 会话列表中群聊消失
- ⚠️ 如果是群主，提示先转让群主

---

### 6. 设置功能测试

#### 6.1 修改密码
1. 进入"我的" → "设置" → "账号管理" → "修改密码"
2. 输入旧密码: `Test123456`
3. 输入新密码: `NewPass123456`
4. 确认新密码
5. 提交

**预期结果**:
- ✅ 修改成功
- ✅ 自动退出登录
- ✅ 使用新密码可以重新登录

#### 6.2 隐私设置
1. 进入"设置" → "隐私设置"
2. 测试各项开关:
   - 加我为好友时需要验证
   - 显示在线状态
   - 黑名单管理

#### 6.3 通知设置
1. 进入"设置" → "通知设置"
2. 测试:
   - 开启/关闭推送通知
   - 设置免打扰时间段

#### 6.4 账号注销（iOS合规）
1. 进入"设置" → "账号管理" → "注销账号"
2. 阅读注销说明
3. 确认注销

**预期结果**:
- ✅ 显示确认对话框（带警告）
- ✅ 账号被注销
- ✅ 所有数据被清除
- ✅ 自动退出登录

⚠️ **警告**: 此操作不可恢复！

#### 6.5 举报功能（iOS合规）
1. 长按消息或进入用户详情
2. 选择"举报"
3. 选择举报类型:
   - 骚扰
   - 垃圾信息
   - 色情内容
   - 诈骗
   - 其他
4. 输入详细描述（最多500字）
5. 提交举报

**预期结果**:
- ✅ 举报成功
- ✅ 显示"举报已提交"提示

---

## 🧪 高级测试场景

### 7.1 离线/在线切换
1. 开启飞行模式
2. 尝试发送消息

**预期结果**:
- ✅ 显示"无网络连接"提示
- ✅ 消息标记为"发送失败"

3. 关闭飞行模式

**预期结果**:
- ✅ 自动重连WebSocket
- ✅ 自动同步离线消息
- ✅ 失败消息可以重新发送

### 7.2 多设备同步
**使用两台设备登录同一账号**:
1. 设备A发送消息
2. 设备B应该立即收到
3. 设备B标记已读
4. 设备A应该看到已读状态更新

### 7.3 消息已读回执
1. 用户1发送消息给用户2
2. 用户2打开会话查看消息
3. 用户1应该看到消息变为"已读"（双勾变蓝）

---

## ⚠️ 已知问题和限制

### 当前版本不支持的功能
- ❌ 图片消息（后端API已就绪，前端未实现）
- ❌ 语音消息（后端API已就绪，前端未实现）
- ❌ 视频消息（后端API已就绪，前端未实现）
- ❌ 文件消息（后端API已就绪，前端未实现）
- ❌ 消息转发（后端API已就绪，前端未实现）
- ❌ 消息搜索（后端API已就绪，前端未实现）
- ⚠️ "@提及"功能（未实现）
- ⚠️ 消息引用回复（后端字段支持，前端UI未实现）

### 依赖警告
- `react-native-web` 版本不匹配（不影响原生应用）
- `react-native-worklets` 版本不匹配（可能影响动画性能）

---

## 📋 测试检查清单

### 认证模块
- [ ] 登录成功
- [ ] 登录失败提示
- [ ] 注册新用户
- [ ] 退出登录

### 会话列表
- [ ] 会话列表加载
- [ ] 下拉刷新
- [ ] 点击进入聊天
- [ ] 未读角标显示

### 私聊功能
- [ ] 发送文本消息
- [ ] 接收消息
- [ ] 消息撤回
- [ ] 历史消息加载
- [ ] 消息状态显示

### 好友管理
- [ ] 搜索用户
- [ ] 发送好友申请
- [ ] 接受好友申请
- [ ] 查看好友列表
- [ ] 设置备注
- [ ] 删除好友

### 群聊功能
- [ ] 创建群组
- [ ] 发送群消息
- [ ] 邀请成员
- [ ] 查看群信息
- [ ] 管理员设置
- [ ] 成员禁言
- [ ] 退出群组

### 设置功能
- [ ] 修改密码
- [ ] 隐私设置
- [ ] 通知设置
- [ ] 账号注销
- [ ] 举报功能

---

## 🐛 问题报告模板

如果发现问题，请按以下格式记录:

```markdown
### 问题描述
简要描述问题

### 重现步骤
1. 步骤1
2. 步骤2
3. 步骤3

### 预期结果
应该发生什么

### 实际结果
实际发生了什么

### 环境信息
- 设备: iPhone 12 / Android 11
- 应用版本: 1.0.0
- 测试账号: 13800138001
- 时间: 2026-01-28 19:20

### 截图/日志
附上相关截图或控制台日志
```

---

## 📞 技术支持

- **后端API文档**: `im/API-ROUTES.md`
- **前后端对齐文档**: `PROJECT-PAGES-SUMMARY.md`
- **测试报告**: `TEST-REPORT.md`

---

**祝测试顺利！** 🎉
